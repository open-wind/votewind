import{a as e,b as t}from"./chunk-FVPDHHYC.js";import{a as i}from"./chunk-3WQQGQIW.js";import{a as n}from"./chunk-UYGXVO4A.js";import{a as s}from"./chunk-OFGHX2F3.js";import"./chunk-VRX6MZUH.js";import"./chunk-EMIRY7IE.js";import"./chunk-LHHREGTA.js";import"./chunk-O2LOQWK4.js";import{a as r}from"./chunk-I4PVU2XE.js";import{d as h}from"./chunk-KLPRJ6SC.js";import{h as u}from"./chunk-4PT23TTH.js";import"./chunk-J4RA3VLE.js";import{a as o,b as p,c as l,d as f}from"./chunk-I4JBCTLR.js";import{a as d}from"./chunk-MCEXFPZL.js";import"./chunk-5IUKPU5Q.js";import"./chunk-B3NSNNUV.js";import{a as a,b as c}from"./chunk-BOXFFUY5.js";import{e as g}from"./chunk-OVZZEY7C.js";var m={};m.clipTriangleAtAxisAlignedThreshold=function(e,t,i,n,s,r){let h,u,o;if(!g(e))throw new a("threshold is required.");if(!g(t))throw new a("keepAbove is required.");if(!g(i))throw new a("u0 is required.");if(!g(n))throw new a("u1 is required.");if(!g(s))throw new a("u2 is required.");g(r)?r.length=0:r=[],t?(h=i<e,u=n<e,o=s<e):(h=i>e,u=n>e,o=s>e);let p=h+u+o,l,f,d,c,m,w;return 1===p?h?(l=(e-i)/(n-i),f=(e-i)/(s-i),r.push(1),r.push(2),1!==f&&(r.push(-1),r.push(0),r.push(2),r.push(f)),1!==l&&(r.push(-1),r.push(0),r.push(1),r.push(l))):u?(d=(e-n)/(s-n),c=(e-n)/(i-n),r.push(2),r.push(0),1!==c&&(r.push(-1),r.push(1),r.push(0),r.push(c)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):o&&(m=(e-s)/(i-s),w=(e-s)/(n-s),r.push(0),r.push(1),1!==w&&(r.push(-1),r.push(2),r.push(1),r.push(w)),1!==m&&(r.push(-1),r.push(2),r.push(0),r.push(m))):2===p?h||i===e?u||n===e?o||s===e||(f=(e-i)/(s-i),d=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(f),r.push(-1),r.push(1),r.push(2),r.push(d)):(w=(e-s)/(n-s),l=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(w),r.push(-1),r.push(0),r.push(1),r.push(l)):(c=(e-n)/(i-n),m=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(c),r.push(-1),r.push(2),r.push(0),r.push(m)):3!==p&&(r.push(0),r.push(1),r.push(2)),r},m.computeBarycentricCoordinates=function(e,t,i,n,s,r,h,u,p){if(!g(e))throw new a("x is required.");if(!g(t))throw new a("y is required.");if(!g(i))throw new a("x1 is required.");if(!g(n))throw new a("y1 is required.");if(!g(s))throw new a("x2 is required.");if(!g(r))throw new a("y2 is required.");if(!g(h))throw new a("x3 is required.");if(!g(u))throw new a("y3 is required.");let l=i-h,f=h-s,d=r-u,c=n-u,m=1/(d*l+f*c),w=t-u,x=e-h,y=(d*x+f*w)*m,I=(-c*x+l*w)*m,B=1-y-I;return g(p)?(p.x=y,p.y=I,p.z=B,p):new o(y,I,B)},m.computeLineSegmentLineSegmentIntersection=function(e,t,i,n,s,r,h,u,o){c.typeOf.number("x00",e),c.typeOf.number("y00",t),c.typeOf.number("x01",i),c.typeOf.number("y01",n),c.typeOf.number("x10",s),c.typeOf.number("y10",r),c.typeOf.number("x11",h),c.typeOf.number("y11",u);let p=(h-s)*(t-r)-(u-r)*(e-s),f=(i-e)*(t-r)-(n-t)*(e-s),d=(u-r)*(i-e)-(h-s)*(n-t);if(0===d)return;let a=p/d,m=f/d;if(a>=0&&a<=1&&m>=0&&m<=1)return g(o)||(o=new l),o.x=e+a*(i-e),o.y=t+a*(n-t),o};var w=[],x=[],y=[],I=new p,B=new o,v=[],A=[],b=[],k=[],V=[],C=new o,O=new h,j=new n,H=new l,N=new o;function T(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}T.prototype.clone=function(e){return g(e)||(e=new T),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},T.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},T.prototype.initializeFromClipResult=function(e,t,i){let n=t+1;return -1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},T.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},T.prototype.isIndexed=function(){return g(this.index)},T.prototype.getH=function(){return g(this.index)?this.heightBuffer[this.index]:d.lerp(this.first.getH(),this.second.getH(),this.ratio)},T.prototype.getU=function(){return g(this.index)?this.uBuffer[this.index]:d.lerp(this.first.getU(),this.second.getU(),this.ratio)},T.prototype.getV=function(){return g(this.index)?this.vBuffer[this.index]:d.lerp(this.first.getV(),this.second.getV(),this.ratio)};var z=new l,R=-1,U=[new o,new o],q=[new o,new o];function E(e,t){let i=U[++R],n=q[R];return i=s.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=s.octDecode(e.second.getNormalX(),e.second.getNormalY(),n),B=o.lerp(i,n,e.ratio,B),o.normalize(B,B),s.octEncode(B,t),--R,t}T.prototype.getNormalX=function(){return g(this.index)?this.normalBuffer[2*this.index]:(z=E(this,z)).x},T.prototype.getNormalY=function(){return g(this.index)?this.normalBuffer[2*this.index+1]:(z=E(this,z)).y};var F=[];function X(e,t,i,n,s,r,h,u,o){if(0===h.length)return;let p=0,l=0;for(;l<h.length;)l=F[p++].initializeFromClipResult(h,l,u);for(let s=0;s<p;++s){let h=F[s];if(h.isIndexed())h.newIndex=r[h.index],h.uBuffer=e,h.vBuffer=t,h.heightBuffer=i,o&&(h.normalBuffer=n);else{let s=h.getKey();if(g(r[s]))h.newIndex=r[s];else{let u=e.length;e.push(h.getU()),t.push(h.getV()),i.push(h.getH()),o&&(n.push(h.getNormalX()),n.push(h.getNormalY())),h.newIndex=u,r[s]=u}}}3===p?(s.push(F[0].newIndex),s.push(F[1].newIndex),s.push(F[2].newIndex)):4===p&&(s.push(F[0].newIndex),s.push(F[1].newIndex),s.push(F[2].newIndex),s.push(F[0].newIndex),s.push(F[2].newIndex),s.push(F[3].newIndex))}F.push(new T),F.push(new T),F.push(new T),F.push(new T);var P=i(function(i,s){let p,l=i.isEastChild,a=i.isNorthChild,c=l?16383:0,g=l?32767:16383,z=a?16383:0,R=a?32767:16383;v.length=0,A.length=0,b.length=0,V.length=0,k.length=0;let U={},q=i.vertices,E=i.indices;E=E.subarray(0,i.indexCountWithoutSkirts);let F=t.clone(i.encoding),P=F.hasVertexNormals,L=0,Y=i.vertexCountWithoutSkirts,S=i.minimumHeight,K=i.maximumHeight,M=Array(Y),W=Array(Y),Q=Array(Y),Z=P?Array(2*Y):void 0,G,J,D,_,$;for(J=0,D=0;J<Y;++J,D+=2){let e=F.decodeTextureCoordinates(q,J,H);if(G=F.decodeHeight(q,J),_=d.clamp(32767*e.x|0,0,32767),$=d.clamp(32767*e.y|0,0,32767),Q[J]=d.clamp((G-S)/(K-S)*32767|0,0,32767),_<20&&(_=0),$<20&&($=0),32767-_<20&&(_=32767),32767-$<20&&($=32767),M[J]=_,W[J]=$,P){let e=F.getOctEncodedNormal(q,J,N);Z[D]=e.x,Z[D+1]=e.y}(l&&_>=16383||!l&&_<=16383)&&(a&&$>=16383||!a&&$<=16383)&&(U[J]=L,v.push(_),A.push($),b.push(Q[J]),P&&(V.push(Z[D]),V.push(Z[D+1])),++L)}let ee=[];ee.push(new T),ee.push(new T),ee.push(new T);let et=[];for(et.push(new T),et.push(new T),et.push(new T),J=0;J<E.length;J+=3){let e=E[J],t=E[J+1],i=E[J+2],n=M[e],s=M[t],r=M[i];ee[0].initializeIndexed(M,W,Q,Z,e),ee[1].initializeIndexed(M,W,Q,Z,t),ee[2].initializeIndexed(M,W,Q,Z,i);let h=m.clipTriangleAtAxisAlignedThreshold(16383,l,n,s,r,w);(p=0)>=h.length||(p=et[0].initializeFromClipResult(h,p,ee))>=h.length||(p=et[1].initializeFromClipResult(h,p,ee))>=h.length||(p=et[2].initializeFromClipResult(h,p,ee),X(v,A,b,V,k,U,m.clipTriangleAtAxisAlignedThreshold(16383,a,et[0].getV(),et[1].getV(),et[2].getV(),x),et,P),p<h.length&&(et[2].clone(et[1]),et[2].initializeFromClipResult(h,p,ee),X(v,A,b,V,k,U,m.clipTriangleAtAxisAlignedThreshold(16383,a,et[0].getV(),et[1].getV(),et[2].getV(),x),et,P)))}let ei=l?-32767:0,en=a?-32767:0,es=[],er=[],eh=[],eu=[],eo=Number.MAX_VALUE,ep=-eo;y.length=0;let el=f.clone(i.ellipsoid),ef=u.clone(i.childRectangle),ed=ef.north,ea=ef.south,ec=ef.east,eg=ef.west;for(ec<eg&&(ec+=d.TWO_PI),J=0;J<v.length;++J)(_=Math.round(v[J]))<=c?(es.push(J),_=0):_>=g?(eh.push(J),_=32767):_=2*_+ei,v[J]=_,($=Math.round(A[J]))<=z?(er.push(J),$=0):$>=R?(eu.push(J),$=32767):$=2*$+en,A[J]=$,(G=d.lerp(S,K,b[J]/32767))<eo&&(eo=G),G>ep&&(ep=G),b[J]=G,I.longitude=d.lerp(eg,ec,_/32767),I.latitude=d.lerp(ea,ed,$/32767),I.height=G,el.cartographicToCartesian(I,B),y.push(B.x),y.push(B.y),y.push(B.z);let em=h.fromVertices(y,o.ZERO,3,O),ew=n.fromRectangle(ef,eo,ep,el,j),ex=new e(el).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(em.center,y,3,em.center,eo,C),ey=ep-eo,eI=new Uint16Array(v.length+A.length+b.length);for(J=0;J<v.length;++J)eI[J]=v[J];let eB=v.length;for(J=0;J<A.length;++J)eI[eB+J]=A[J];for(eB+=A.length,J=0;J<b.length;++J)eI[eB+J]=32767*(b[J]-eo)/ey;let ev=r.createTypedArray(v.length,k),eA;if(P){let e=new Uint8Array(V);s.push(eI.buffer,ev.buffer,e.buffer),eA=e.buffer}else s.push(eI.buffer,ev.buffer);return{vertices:eI.buffer,encodedNormals:eA,indices:ev.buffer,minimumHeight:eo,maximumHeight:ep,westIndices:es,southIndices:er,eastIndices:eh,northIndices:eu,boundingSphere:em,orientedBoundingBox:ew,horizonOcclusionPoint:ex}});export{P as default};