import{c as e}from"./chunk-KLPRJ6SC.js";import{a as t,b as r,e as n}from"./chunk-I4JBCTLR.js";import{a as i}from"./chunk-MCEXFPZL.js";import{a as o,b as a}from"./chunk-BOXFFUY5.js";import{e as u}from"./chunk-OVZZEY7C.js";var s={};function l(e,t,r){let n=e+t;return i.sign(e)!==i.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<r?0:n}s.computeDiscriminant=function(e,t,r){if("number"!=typeof e)throw new o("a is a required number.");if("number"!=typeof t)throw new o("b is a required number.");if("number"!=typeof r)throw new o("c is a required number.");return t*t-4*e*r},s.computeRealRoots=function(e,t,r){let n;if("number"!=typeof e)throw new o("a is a required number.");if("number"!=typeof t)throw new o("b is a required number.");if("number"!=typeof r)throw new o("c is a required number.");if(0===e)return 0===t?[]:[-r/t];if(0===t){if(0===r)return[0,0];let t=Math.abs(r),o=Math.abs(e);if(t<o&&t/o<i.EPSILON14)return[0,0];if(t>o&&o/t<i.EPSILON14||(n=-r/e)<0)return[];let a=Math.sqrt(n);return[-a,a]}if(0===r)return(n=-t/e)<0?[n,0]:[0,n];let a=l(t*t,-(4*e*r),i.EPSILON14);if(a<0)return[];let u=-.5*l(t,i.sign(t)*Math.sqrt(a),i.EPSILON14);return t>0?[u/e,r/u]:[r/u,u/e]};var f={};function c(e,t,r,n){let i=t/3,o=r/3,a=e*o,u=i*n,s=i*i,l=o*o,f=e*o-s,c=e*n-i*o,h=i*n-l,w=4*f*h-c*c,m,d;if(w<0){let t,r,p;s*u>=a*l?(t=e,r=f,p=-2*i*f+e*c):(t=n,r=h,p=-n*c+2*o*h);let b=-(p<0?-1:1)*Math.abs(t)*Math.sqrt(-w),g=(d=-p+b)/2,q=g<0?-Math.pow(-g,1/3):Math.pow(g,1/3),M=d===b?-q:-r/q;return m=r<=0?q+M:-p/(q*q+M*M+r),s*u>=a*l?[(m-i)/e]:[-n/(m+o)]}let p=Math.sqrt(w),b=Math.sqrt(3)/2,g=Math.abs(Math.atan2(e*p,-(-2*i*f+e*c))/3),q=Math.cos(g);d=(m=2*Math.sqrt(-f))*q;let M=m*(-q/2-b*Math.sin(g)),y=d+M>2*i?d-i:M-i,R=y/e;g=Math.abs(Math.atan2(n*p,-(-n*c+2*o*h))/3),d=(m=2*Math.sqrt(-h))*(q=Math.cos(g)),M=m*(-q/2-b*Math.sin(g));let S=-n,O=d+M<2*o?d+o:M+o,P=S/O,L=-y*O-e*S,N=(o*L-y*S*i)/(-i*L+e*O*o);return R<=N?R<=P?N<=P?[R,N,P]:[R,P,N]:[P,R,N]:R<=P?[N,R,P]:N<=P?[N,P,R]:[P,N,R]}f.computeDiscriminant=function(e,t,r,n){if("number"!=typeof e)throw new o("a is a required number.");if("number"!=typeof t)throw new o("b is a required number.");if("number"!=typeof r)throw new o("c is a required number.");if("number"!=typeof n)throw new o("d is a required number.");let i=t*t,a=r*r;return 18*e*t*r*n+i*a-e*e*27*(n*n)-4*(e*a*r+i*t*n)},f.computeRealRoots=function(e,t,r,n){let i,a;if("number"!=typeof e)throw new o("a is a required number.");if("number"!=typeof t)throw new o("b is a required number.");if("number"!=typeof r)throw new o("c is a required number.");if("number"!=typeof n)throw new o("d is a required number.");if(0===e)return s.computeRealRoots(t,r,n);if(0===t){if(0===r){if(0===n)return[0,0,0];let t=(a=-n/e)<0?-Math.pow(-a,1/3):Math.pow(a,1/3);return[t,t,t]}return 0===n?0===(i=s.computeRealRoots(e,0,r)).Length?[0]:[i[0],0,i[1]]:c(e,0,r,n)}return 0===r?0===n?(a=-t/e)<0?[a,0,0]:[0,0,a]:c(e,t,0,n):0===n?0===(i=s.computeRealRoots(e,t,r)).length?[0]:i[1]<=0?[i[0],i[1],0]:i[0]>=0?[0,i[0],i[1]]:[i[0],0,i[1]]:c(e,t,r,n)};var h={};function w(e,r){r=t.clone(r??t.ZERO),t.equals(r,t.ZERO)||t.normalize(r,r),this.origin=t.clone(e??t.ZERO),this.direction=r}h.computeDiscriminant=function(e,t,r,n,i){if("number"!=typeof e)throw new o("a is a required number.");if("number"!=typeof t)throw new o("b is a required number.");if("number"!=typeof r)throw new o("c is a required number.");if("number"!=typeof n)throw new o("d is a required number.");if("number"!=typeof i)throw new o("e is a required number.");let a=e*e,u=t*t,s=u*t,l=r*r,f=l*r,c=n*n,h=c*n,w=i*i;return u*l*c-4*s*h-4*e*f*c+18*e*t*r*h-27*a*c*c+a*e*256*(w*i)+i*(18*s*r*n-4*u*f+16*e*l*l-80*e*t*l*n-6*e*u*c+144*a*r*c)+w*(144*e*u*r-27*u*u-128*a*l-192*a*t*n)},h.computeRealRoots=function(e,t,r,n,a){if("number"!=typeof e)throw new o("a is a required number.");if("number"!=typeof t)throw new o("b is a required number.");if("number"!=typeof r)throw new o("c is a required number.");if("number"!=typeof n)throw new o("d is a required number.");if("number"!=typeof a)throw new o("e is a required number.");if(Math.abs(e)<i.EPSILON15)return f.computeRealRoots(t,r,n,a);let u=t/e,l=r/e,c=n/e,h=a/e,w=u<0?1:0;switch(w+=l<0?w+1:w,w+=c<0?w+1:w,w+=h<0?w+1:w){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return function(e,t,r,n){let o=e*e,a=t-3*o/8,u=r-t*e/2+o*e/8,l=n-r*e/4+t*o/16-3*o*o/256,c=f.computeRealRoots(1,2*a,a*a-4*l,-u*u);if(c.length>0){let t=-e/4,r=c[c.length-1];if(Math.abs(r)<i.EPSILON14){let e=s.computeRealRoots(1,a,l);if(2===e.length){let r=e[0],n=e[1],i;if(r>=0&&n>=0){let e=Math.sqrt(r),i=Math.sqrt(n);return[t-i,t-e,t+e,t+i]}if(r>=0&&n<0)return[t-(i=Math.sqrt(r)),t+i];if(r<0&&n>=0)return[t-(i=Math.sqrt(n)),t+i]}}else if(r>0){let e=Math.sqrt(r),n=s.computeRealRoots(1,e,(a+r-u/e)/2),i=s.computeRealRoots(1,-e,(a+r+u/e)/2);return 0!==n.length?(n[0]+=t,n[1]+=t,0!==i.length?(i[0]+=t,i[1]+=t,n[1]<=i[0]?[n[0],n[1],i[0],i[1]]:i[1]<=n[0]?[i[0],i[1],n[0],n[1]]:n[0]>=i[0]&&n[1]<=i[1]?[i[0],n[0],n[1],i[1]]:i[0]>=n[0]&&i[1]<=n[1]?[n[0],i[0],i[1],n[1]]:n[0]>i[0]&&n[0]<i[1]?[i[0],n[0],i[1],n[1]]:[n[0],i[0],n[1],i[1]]):n):0!==i.length?(i[0]+=t,i[1]+=t,i):[]}}return[]}(u,l,c,h);case 1:case 2:case 5:case 8:case 11:return function(e,t,r,n){let o=e*e,a=f.computeRealRoots(1,-2*t,r*e+t*t-4*n,o*n-r*t*e+r*r);if(a.length>0){let u,l,f,c,h=a[0],w=t-h,m=w*w,d=e/2,p=w/2,b=m-4*n,g=m+4*Math.abs(n),q=o-4*h,M=o+4*Math.abs(h),y,R;if(h<0||b*M<q*g){let t=Math.sqrt(q);y=t/2,R=0===t?0:(e*p-r)/t}else{let t=Math.sqrt(b);y=0===t?0:(e*p-r)/t,R=t/2}0===d&&0===y?(u=0,l=0):i.sign(d)===i.sign(y)?l=h/(u=d+y):u=h/(l=d-y),0===p&&0===R?(f=0,c=0):i.sign(p)===i.sign(R)?c=n/(f=p+R):f=n/(c=p-R);let S=s.computeRealRoots(1,u,f),O=s.computeRealRoots(1,l,c);if(0!==S.length)return 0!==O.length?S[1]<=O[0]?[S[0],S[1],O[0],O[1]]:O[1]<=S[0]?[O[0],O[1],S[0],S[1]]:S[0]>=O[0]&&S[1]<=O[1]?[O[0],S[0],S[1],O[1]]:O[0]>=S[0]&&O[1]<=S[1]?[S[0],O[0],O[1],S[1]]:S[0]>O[0]&&S[0]<O[1]?[O[0],S[0],O[1],S[1]]:[S[0],O[0],S[1],O[1]]:S;if(0!==O.length)return O}return[]}(u,l,c,h);default:return}},w.clone=function(e,r){if(u(e))return u(r)?(r.origin=t.clone(e.origin),r.direction=t.clone(e.direction),r):new w(e.origin,e.direction)},w.getPoint=function(e,r,n){return a.typeOf.object("ray",e),a.typeOf.number("t",r),u(n)||(n=new t),n=t.multiplyByScalar(e.direction,r,n),t.add(e.origin,n,n)};var m=w,d={};d.rayPlane=function(e,r,n){if(!u(e))throw new o("ray is required.");if(!u(r))throw new o("plane is required.");u(n)||(n=new t);let a=e.origin,s=e.direction,l=r.normal,f=t.dot(l,s);if(Math.abs(f)<i.EPSILON15)return;let c=(-r.distance-t.dot(l,a))/f;if(!(c<0))return n=t.multiplyByScalar(s,c,n),t.add(a,n,n)};var p=new t,b=new t,g=new t,q=new t,M=new t;d.rayTriangleParametric=function(e,r,n,a,s){if(!u(e))throw new o("ray is required.");if(!u(r))throw new o("p0 is required.");if(!u(n))throw new o("p1 is required.");if(!u(a))throw new o("p2 is required.");s=s??!1;let l=e.origin,f=e.direction,c=t.subtract(n,r,p),h=t.subtract(a,r,b),w=t.cross(f,h,g),m=t.dot(c,w),d,y,R,S,O;if(s){if(m<i.EPSILON6||(d=t.subtract(l,r,q),(R=t.dot(d,w))<0||R>m)||(y=t.cross(d,c,M),(S=t.dot(f,y))<0||R+S>m))return;O=t.dot(h,y)/m}else{if(Math.abs(m)<i.EPSILON6)return;let e=1/m;if(d=t.subtract(l,r,q),(R=t.dot(d,w)*e)<0||R>1||(y=t.cross(d,c,M),(S=t.dot(f,y)*e)<0||R+S>1))return;O=t.dot(h,y)*e}return O},d.rayTriangle=function(e,r,n,i,o,a){let s=d.rayTriangleParametric(e,r,n,i,o);if(!(!u(s)||s<0))return u(a)||(a=new t),t.multiplyByScalar(e.direction,s,a),t.add(e.origin,a,a)};var y=new m;d.lineSegmentTriangle=function(e,r,n,i,a,s,l){if(!u(e))throw new o("v0 is required.");if(!u(r))throw new o("v1 is required.");if(!u(n))throw new o("p0 is required.");if(!u(i))throw new o("p1 is required.");if(!u(a))throw new o("p2 is required.");t.clone(e,y.origin),t.subtract(r,e,y.direction),t.normalize(y.direction,y.direction);let f=d.rayTriangleParametric(y,n,i,a,s);if(!(!u(f)||f<0||f>t.distance(e,r)))return u(l)||(l=new t),t.multiplyByScalar(y.direction,f,l),t.add(y.origin,l,l)};var R={root0:0,root1:0};function S(r,n,i){u(i)||(i=new e);let o=r.origin,a=r.direction,s=n.center,l=n.radius*n.radius,f=t.subtract(o,s,g),c=function(e,t,r,n){let i=t*t-4*e*r;if(i<0)return;if(i>0){let r=1/(2*e),o=Math.sqrt(i),a=(-t+o)*r,u=(-t-o)*r;return a<u?(n.root0=a,n.root1=u):(n.root0=u,n.root1=a),n}let o=-t/(2*e);if(0!==o)return n.root0=n.root1=o,n}(t.dot(a,a),2*t.dot(a,f),t.magnitudeSquared(f)-l,R);if(u(c))return i.start=c.root0,i.stop=c.root1,i}d.raySphere=function(e,t,r){if(!u(e))throw new o("ray is required.");if(!u(t))throw new o("sphere is required.");if(!(!u(r=S(e,t,r))||r.stop<0))return r.start=Math.max(r.start,0),r};var O=new m;d.lineSegmentSphere=function(e,r,n,i){if(!u(e))throw new o("p0 is required.");if(!u(r))throw new o("p1 is required.");if(!u(n))throw new o("sphere is required.");t.clone(e,O.origin);let a=t.subtract(r,e,O.direction),s=t.magnitude(a);if(t.normalize(a,a),!(!u(i=S(O,n,i))||i.stop<0||i.start>s))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,s),i};var P=new t,L=new t;function N(e,t,r){let n=e+t;return i.sign(e)!==i.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<r?0:n}d.rayEllipsoid=function(r,n){if(!u(r))throw new o("ray is required.");if(!u(n))throw new o("ellipsoid is required.");let i=n.oneOverRadii,a=t.multiplyComponents(i,r.origin,P),s=t.multiplyComponents(i,r.direction,L),l=t.magnitudeSquared(a),f=t.dot(a,s),c,h,w,m,d;if(l>1){if(f>=0)return;let r=f*f;if(c=l-1,r<(w=(h=t.magnitudeSquared(s))*c))return;if(r>w){m=f*f-w;let t=(d=-f+Math.sqrt(m))/h,r=c/d;return t<r?new e(t,r):{start:r,stop:t}}let n=Math.sqrt(c/h);return new e(n,n)}return l<1?(c=l-1,m=f*f-(w=(h=t.magnitudeSquared(s))*c),new e(0,(d=-f+Math.sqrt(m))/h)):f<0?new e(0,-f/(h=t.magnitudeSquared(s))):void 0},d.quadraticVectorExpression=function(e,r,o,a,u){let l=a*a,f=u*u,c=(e[n.COLUMN1ROW1]-e[n.COLUMN2ROW2])*f,w=u*(a*N(e[n.COLUMN1ROW0],e[n.COLUMN0ROW1],i.EPSILON15)+r.y),m=e[n.COLUMN0ROW0]*l+e[n.COLUMN2ROW2]*f+a*r.x+o,d=f*N(e[n.COLUMN2ROW1],e[n.COLUMN1ROW2],i.EPSILON15),p=u*(a*N(e[n.COLUMN2ROW0],e[n.COLUMN0ROW2])+r.z),b,g=[];if(0===p&&0===d){if(0===(b=s.computeRealRoots(c,w,m)).length)return g;let e=b[0],r=Math.sqrt(Math.max(1-e*e,0));if(g.push(new t(a,u*e,-(u*r))),g.push(new t(a,u*e,u*r)),2===b.length){let e=b[1],r=Math.sqrt(Math.max(1-e*e,0));g.push(new t(a,u*e,-(u*r))),g.push(new t(a,u*e,u*r))}return g}let q=p*p,M=d*d,y=p*d,R=c*c+M,S=2*(w*c+y),O=2*m*c+w*w-M+q,P=2*(m*w-y),L=m*m-q;if(0===R&&0===S&&0===O&&0===P)return g;let E=(b=h.computeRealRoots(R,S,O,P,L)).length;if(0===E)return g;for(let e=0;e<E;++e){let r=b[e],n=r*r,o=Math.sqrt(Math.max(1-n,0)),s=(i.sign(c)===i.sign(m)?N(c*n+m,w*r,i.EPSILON12):i.sign(m)===i.sign(w*r)?N(c*n,w*r+m,i.EPSILON12):N(c*n+w*r,m,i.EPSILON12))*N(d*r,p,i.EPSILON15);s<0?g.push(new t(a,u*r,u*o)):s>0?g.push(new t(a,u*r,-(u*o))):0!==o?(g.push(new t(a,u*r,-(u*o))),g.push(new t(a,u*r,u*o)),++e):g.push(new t(a,u*r,u*o))}return g};var E=new t,I=new t,C=new t,v=new t,x=new t,z=new n,T=new n,U=new n,B=new n,W=new n,Z=new n,V=new n,j=new t,k=new t,F=new r;d.grazingAltitudeLocation=function(e,r){if(!u(e))throw new o("ray is required.");if(!u(r))throw new o("ellipsoid is required.");let a=e.origin,s=e.direction;if(!t.equals(a,t.ZERO)){let e=r.geodeticSurfaceNormal(a,E);if(t.dot(s,e)>=0)return a}let l=u(this.rayEllipsoid(e,r)),f=r.transformPositionToScaledSpace(s,E),c=t.normalize(f,f),h=t.mostOrthogonalAxis(f,v),w=t.normalize(t.cross(h,c,I),I),m=t.normalize(t.cross(c,w,C),C);z[0]=c.x,z[1]=c.y,z[2]=c.z,z[3]=w.x,z[4]=w.y,z[5]=w.z,z[6]=m.x,z[7]=m.y,z[8]=m.z;let p=n.transpose(z,T),b=n.fromScale(r.radii,U),g=n.fromScale(r.oneOverRadii,B);W[0]=0,W[1]=-s.z,W[2]=s.y,W[3]=s.z,W[4]=0,W[5]=-s.x,W[6]=-s.y,W[7]=s.x,W[8]=0;let q=n.multiply(n.multiply(p,g,Z),W,Z),M=n.multiply(n.multiply(q,b,V),z,V),y=n.multiplyByVector(q,a,x),R=d.quadraticVectorExpression(M,t.negate(y,E),0,0,1),S,O,P=R.length;if(P>0){let e=t.clone(t.ZERO,k),o=Number.NEGATIVE_INFINITY;for(let r=0;r<P;++r){S=n.multiplyByVector(b,n.multiplyByVector(z,R[r],j),j);let i=t.normalize(t.subtract(S,a,v),v),u=t.dot(i,s);u>o&&(o=u,e=t.clone(S,e))}let u=r.cartesianToCartographic(e,F);return o=i.clamp(o,0,1),O=t.magnitude(t.subtract(e,a,v))*Math.sqrt(1-o*o),O=l?-O:O,u.height=O,r.cartographicToCartesian(u,new t)}};var A=new t;d.lineSegmentPlane=function(e,r,n,a){if(!u(e))throw new o("endPoint0 is required.");if(!u(r))throw new o("endPoint1 is required.");if(!u(n))throw new o("plane is required.");u(a)||(a=new t);let s=t.subtract(r,e,A),l=n.normal,f=t.dot(l,s);if(Math.abs(f)<i.EPSILON6)return;let c=t.dot(l,e),h=-(n.distance+c)/f;if(!(h<0||h>1))return t.multiplyByScalar(s,h,a),t.add(e,a,a),a},d.trianglePlaneIntersection=function(e,r,n,i){let a,s;if(!u(e)||!u(r)||!u(n)||!u(i))throw new o("p0, p1, p2, and plane are required.");let l=i.normal,f=i.distance,c=t.dot(l,e)+f<0,h=t.dot(l,r)+f<0,w=t.dot(l,n)+f<0,m;if((1==(m=0+((c?1:0)+(h?1:0)+(w?1:0)))||2===m)&&(a=new t,s=new t),1===m){if(c)return d.lineSegmentPlane(e,r,i,a),d.lineSegmentPlane(e,n,i,s),{positions:[e,r,n,a,s],indices:[0,3,4,1,2,4,1,4,3]};if(h)return d.lineSegmentPlane(r,n,i,a),d.lineSegmentPlane(r,e,i,s),{positions:[e,r,n,a,s],indices:[1,3,4,2,0,4,2,4,3]};if(w)return d.lineSegmentPlane(n,e,i,a),d.lineSegmentPlane(n,r,i,s),{positions:[e,r,n,a,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===m){if(!c)return d.lineSegmentPlane(r,e,i,a),d.lineSegmentPlane(n,e,i,s),{positions:[e,r,n,a,s],indices:[1,2,4,1,4,3,0,3,4]};if(!h)return d.lineSegmentPlane(n,r,i,a),d.lineSegmentPlane(e,r,i,s),{positions:[e,r,n,a,s],indices:[2,0,4,2,4,3,1,3,4]};if(!w)return d.lineSegmentPlane(e,n,i,a),d.lineSegmentPlane(r,n,i,s),{positions:[e,r,n,a,s],indices:[0,1,4,0,4,3,2,3,4]}}};var D=d;export{m as a,D as b};