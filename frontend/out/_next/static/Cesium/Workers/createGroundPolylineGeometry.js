import{a as e}from"./chunk-R6YCVUGT.js";import{a as t}from"./chunk-4KTYBIT7.js";import{a as n}from"./chunk-GT4KWHVH.js";import{a as i}from"./chunk-F27AWPUY.js";import{a as r}from"./chunk-VKBMYYL4.js";import{a as a}from"./chunk-MQ2J7IEP.js";import{b as o}from"./chunk-LHHREGTA.js";import{a as l}from"./chunk-O2LOQWK4.js";import{c as s,d as u}from"./chunk-OST65WKL.js";import{a as c,d as p}from"./chunk-KLPRJ6SC.js";import{d as h,e as d,f as f,h as g}from"./chunk-4PT23TTH.js";import{a as m}from"./chunk-J4RA3VLE.js";import{a as w,b as y,c as T,d as O,e as _,f as k}from"./chunk-I4JBCTLR.js";import{a as E}from"./chunk-MCEXFPZL.js";import"./chunk-5IUKPU5Q.js";import"./chunk-B3NSNNUV.js";import{a as L,b as P}from"./chunk-BOXFFUY5.js";import{e as A}from"./chunk-OVZZEY7C.js";function b(e){e=e??k.EMPTY_OBJECT,this._ellipsoid=e.ellipsoid??O.default,this._rectangle=e.rectangle??g.MAX_VALUE,this._projection=new c(this._ellipsoid),this._numberOfLevelZeroTilesX=e.numberOfLevelZeroTilesX??2,this._numberOfLevelZeroTilesY=e.numberOfLevelZeroTilesY??1}Object.defineProperties(b.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),b.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},b.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},b.prototype.rectangleToNativeRectangle=function(e,t){P.defined("rectangle",e);let n=E.toDegrees(e.west),i=E.toDegrees(e.south),r=E.toDegrees(e.east),a=E.toDegrees(e.north);return A(t)?(t.west=n,t.south=i,t.east=r,t.north=a,t):new g(n,i,r,a)},b.prototype.tileXYToNativeRectangle=function(e,t,n,i){let r=this.tileXYToRectangle(e,t,n,i);return r.west=E.toDegrees(r.west),r.south=E.toDegrees(r.south),r.east=E.toDegrees(r.east),r.north=E.toDegrees(r.north),r},b.prototype.tileXYToRectangle=function(e,t,n,i){let r=this._rectangle,a=this.getNumberOfXTilesAtLevel(n),o=this.getNumberOfYTilesAtLevel(n),l=r.width/a,s=e*l+r.west,u=(e+1)*l+r.west,c=r.height/o,p=r.north-t*c,h=r.north-(t+1)*c;return A(i)||(i=new g(s,h,u,p)),i.west=s,i.south=h,i.east=u,i.north=p,i},b.prototype.positionToTileXY=function(e,t,n){let i=this._rectangle;if(!g.contains(i,e))return;let r=this.getNumberOfXTilesAtLevel(t),a=this.getNumberOfYTilesAtLevel(t),o=i.width/r,l=i.height/a,s=e.longitude;i.east<i.west&&(s+=E.TWO_PI);let u=(s-i.west)/o|0;u>=r&&(u=r-1);let c=(i.north-e.latitude)/l|0;return c>=a&&(c=a-1),A(n)?(n.x=u,n.y=c,n):new T(u,c)};var I=new w,v=new w,N=new y,S=new w,x=new w,j=new p,H=new b,M=[new y,new y,new y,new y],C=new T,D={};function z(e){y.fromRadians(e.east,e.north,0,M[0]),y.fromRadians(e.west,e.north,0,M[1]),y.fromRadians(e.east,e.south,0,M[2]),y.fromRadians(e.west,e.south,0,M[3]);let t=0,n=0,i=0,r=0,a=D._terrainHeightsMaxLevel,o;for(o=0;o<=a;++o){let e=!1;for(let t=0;t<4;++t){let n=M[t];if(H.positionToTileXY(n,o,C),0===t)i=C.x,r=C.y;else if(i!==C.x||r!==C.y){e=!0;break}}if(e)break;t=i,n=r}if(0!==o)return{x:t,y:n,level:o>a?a:o-1}}D.initialize=function(){let e=D._initPromise;return A(e)||(e=h.fetchJson(d("Assets/approximateTerrainHeights.json")).then(function(e){D._terrainHeights=e}),D._initPromise=e),e},D.getMinimumMaximumHeights=function(e,t){if(P.defined("rectangle",e),!A(D._terrainHeights))throw new L("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=t??O.default;let n=z(e),i=D._defaultMinTerrainHeight,r=D._defaultMaxTerrainHeight;if(A(n)){let a=`${n.level}-${n.x}-${n.y}`,o=D._terrainHeights[a];A(o)&&(i=o[0],r=o[1]),t.cartographicToCartesian(g.northeast(e,N),I),t.cartographicToCartesian(g.southwest(e,N),v),w.midpoint(v,I,S);let l=t.scaleToGeodeticSurface(S,x);i=A(l)?Math.min(i,-w.distance(S,l)):D._defaultMinTerrainHeight}return{minimumTerrainHeight:i=Math.max(D._defaultMinTerrainHeight,i),maximumTerrainHeight:r}},D.getBoundingSphere=function(e,t){if(P.defined("rectangle",e),!A(D._terrainHeights))throw new L("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=t??O.default;let n=z(e),i=D._defaultMaxTerrainHeight;if(A(n)){let e=`${n.level}-${n.x}-${n.y}`,t=D._terrainHeights[e];A(t)&&(i=t[1])}let r=p.fromRectangle3D(e,t,0);return p.fromRectangle3D(e,t,i,j),p.union(r,j,r)},D._terrainHeightsMaxLevel=6,D._defaultMaxTerrainHeight=9e3,D._defaultMinTerrainHeight=-1e5,D._terrainHeights=void 0,D._initPromise=void 0,Object.defineProperties(D,{initialized:{get:function(){return A(D._terrainHeights)}}});var R=[c,e],Y=R.length,B=Math.cos(E.toRadians(30)),F=Math.cos(E.toRadians(150));function U(e){let n=(e=e??k.EMPTY_OBJECT).positions;if(!A(n)||n.length<2)throw new L("At least two positions are required.");if(A(e.arcType)&&e.arcType!==t.GEODESIC&&e.arcType!==t.RHUMB)throw new L("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=e.width??1,this._positions=n,this.granularity=e.granularity??9999,this.loop=e.loop??!1,this.arcType=e.arcType??t.GEODESIC,this._ellipsoid=O.default,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(U.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+O.packedLength+1+1}}}),U.setProjectionAndEllipsoid=function(e,t){let n=0;for(let e=0;e<Y;e++)if(t instanceof R[e]){n=e;break}e._projectionIndex=n,e._ellipsoid=t.ellipsoid};var X=new w,q=new w,G=new w;function V(e,t,n,i,r){let a=ee(i,e,0,X),o=ee(i,e,n,q),l=ee(i,t,0,G),s=et(o,a,q),u=et(l,a,G);return w.cross(u,s,r),w.normalize(r,r)}var Z=new y,W=new w,J=new w,K=new w;function $(e,n,r,o,l,s,u,c,p,h,d){let f;if(0===l)return;s===t.GEODESIC?f=new i(e,n,u):s===t.RHUMB&&(f=new a(e,n,u));let g=f.surfaceDistance;if(g<l)return;let m=V(e,n,o,u,K),y=Math.ceil(g/l),T=g/y,O=T,_=y-1,k=c.length;for(let e=0;e<_;e++){let e=f.interpolateUsingSurfaceDistance(O,Z),t=ee(u,e,r,W),n=ee(u,e,o,J);w.pack(m,c,k),w.pack(t,p,k),w.pack(n,h,k),d.push(e.latitude),d.push(e.longitude),k+=3,O+=T}}var Q=new y;function ee(e,t,n,i){return y.clone(t,Q),Q.height=n,y.toCartesian(Q,e,i)}function et(e,t,n){return w.subtract(e,t,n),w.normalize(n,n),n}function en(e,t,n,i){return i=et(e,t,i),i=w.cross(i,n,i),i=w.normalize(i,i),i=w.cross(n,i,i)}U.pack=function(e,t,n){P.typeOf.object("value",e),P.defined("array",t);let i=n??0,r=e._positions,a=r.length;t[i++]=a;for(let e=0;e<a;++e){let n=r[e];w.pack(n,t,i),i+=3}return t[i++]=e.granularity,t[i++]=e.loop?1:0,t[i++]=e.arcType,O.pack(e._ellipsoid,t,i),i+=O.packedLength,t[i++]=e._projectionIndex,t[i++]=e._scene3DOnly?1:0,t},U.unpack=function(e,t,n){P.defined("array",e);let i=t??0,r=e[i++],a=Array(r);for(let t=0;t<r;t++)a[t]=w.unpack(e,i),i+=3;let o=e[i++],l=1===e[i++],s=e[i++],u=O.unpack(e,i);i+=O.packedLength;let c=e[i++],p=1===e[i++];return A(n)||(n=new U({positions:a})),n._positions=a,n.granularity=o,n.loop=l,n.arcType=s,n._ellipsoid=u,n._projectionIndex=c,n._scene3DOnly=p,n};var ei=new w,er=new w,ea=new w,eo=new w;function el(e,t,n,i,r){let a=et(n,t,eo),o=en(e,t,a,ei),l=en(i,t,a,er);if(E.equalsEpsilon(w.dot(o,l),-1,E.EPSILON5))return r=w.cross(a,o,r),r=w.normalize(r,r);r=w.add(l,o,r),r=w.normalize(r,r);let s=w.cross(a,r,ea);return 0>w.dot(l,s)&&(r=w.negate(r,r)),r}var es=l.fromPointNormal(w.ZERO,w.UNIT_Y),eu=new w,ec=new w,ep=new w,eh=new w,ed=new w,ef=new w,eg=new y,em=new y,ew=new y;U.createGeometry=function(e){let i=!e._scene3DOnly,l=e.loop,c=e._ellipsoid,h=e.granularity,d=e.arcType,f=new R[e._projectionIndex](c),T,O,_=e._positions,k=_.length;2===k&&(l=!1);let L,P,b,I,v=new a(void 0,void 0,c),N,S,x,j=[_[0]];for(O=0;O<k-1;O++)L=_[O],P=_[O+1],!A(N=o.lineSegmentPlane(L,P,es,ef))||w.equalsEpsilon(N,L,E.EPSILON7)||w.equalsEpsilon(N,P,E.EPSILON7)||(e.arcType===t.GEODESIC?j.push(w.clone(N)):e.arcType!==t.RHUMB||(x=c.cartesianToCartographic(N,eg).longitude,b=c.cartesianToCartographic(L,eg),I=c.cartesianToCartographic(P,em),v.setEndPoints(b,I),S=v.findIntersectionWithLongitude(x,ew),!A(N=c.cartographicToCartesian(S,ef))||w.equalsEpsilon(N,L,E.EPSILON7)||w.equalsEpsilon(N,P,E.EPSILON7)||j.push(w.clone(N)))),j.push(P);!l||(L=_[k-1],P=_[0],!A(N=o.lineSegmentPlane(L,P,es,ef))||w.equalsEpsilon(N,L,E.EPSILON7)||w.equalsEpsilon(N,P,E.EPSILON7)||(e.arcType===t.GEODESIC?j.push(w.clone(N)):e.arcType!==t.RHUMB||(x=c.cartesianToCartographic(N,eg).longitude,b=c.cartesianToCartographic(L,eg),I=c.cartesianToCartographic(P,em),v.setEndPoints(b,I),S=v.findIntersectionWithLongitude(x,ew),!A(N=c.cartographicToCartesian(S,ef))||w.equalsEpsilon(N,L,E.EPSILON7)||w.equalsEpsilon(N,P,E.EPSILON7)||j.push(w.clone(N)))));let H=j.length,M=Array(H);for(O=0;O<H;O++){let e=y.fromCartesian(j[O],c);e.height=0,M[O]=e}if((H=(M=r(M,y.equalsEpsilon)).length)<2)return;let C=[],z=[],Y=[],F=[],U=eu,X=ec,q=ep,G=eh,Z=ed,W=M[0],J=M[1];for(U=ee(c,M[H-1],0,U),G=ee(c,J,0,G),X=ee(c,W,0,X),q=ee(c,W,1e3,q),Z=l?el(U,X,q,G,Z):V(W,J,1e3,c,Z),w.pack(Z,z,0),w.pack(X,Y,0),w.pack(q,F,0),C.push(W.latitude),C.push(W.longitude),$(W,J,0,1e3,h,d,c,z,Y,F,C),O=1;O<H-1;++O){U=w.clone(X,U),X=w.clone(G,X);let e=M[O];ee(c,e,1e3,q),ee(c,M[O+1],0,G),el(U,X,q,G,Z),T=z.length,w.pack(Z,z,T),w.pack(X,Y,T),w.pack(q,F,T),C.push(e.latitude),C.push(e.longitude),$(M[O],M[O+1],0,1e3,h,d,c,z,Y,F,C)}let K=M[H-1],Q=M[H-2];if(X=ee(c,K,0,X),q=ee(c,K,1e3,q),l){let e=M[0];Z=el(U=ee(c,Q,0,U),X,q,G=ee(c,e,0,G),Z)}else Z=V(Q,K,1e3,c,Z);if(T=z.length,w.pack(Z,z,T),w.pack(X,Y,T),w.pack(q,F,T),C.push(K.latitude),C.push(K.longitude),l){for($(K,W,0,1e3,h,d,c,z,Y,F,C),T=z.length,O=0;O<3;++O)z[T+O]=z[O],Y[T+O]=Y[O],F[T+O]=F[O];C.push(W.latitude),C.push(W.longitude)}return function(e,t,i,r,a,o,l){let c,h,d,f=t._ellipsoid,y=i.length/3-1,T=8*y,O=4*T,_=36*y,k=T>65535?new Uint32Array(_):new Uint16Array(_),L=new Float64Array(3*T),P=new Float32Array(O),A=new Float32Array(O),b=new Float32Array(O),I=new Float32Array(O),v=new Float32Array(O),N,S,x,j;l&&(N=new Float32Array(O),S=new Float32Array(O),x=new Float32Array(O),j=new Float32Array(2*T));let H=o.length/2,M=0;eS.height=0,ex.height=0;let C=ej,z=eH;if(l)for(d=0,h=1;h<H;h++)eS.latitude=o[d],eS.longitude=o[d+1],ex.latitude=o[d+2],ex.longitude=o[d+3],C=t.project(eS,C),z=t.project(ex,z),M+=w.distance(C,z),d+=2;let R=r.length/3;z=w.unpack(r,0,z);let Y=0;for(d=3,h=1;h<R;h++)C=w.clone(z,C),z=w.unpack(r,d,z),Y+=w.distance(C,z),d+=3;d=3;let F=0,U=0,X=0,q=0,G=!1,V=w.unpack(i,0,eC),Z=w.unpack(r,0,eH),W=w.unpack(a,0,ez);e&&e_(W,w.unpack(i,i.length-6,eM),V,Z)&&(W=w.negate(W,W));let J=0,K=0,$=0;for(h=0;h<y;h++){let e,s,u,p,h=w.clone(V,eM),m=w.clone(Z,ej),y=w.clone(W,eD);if(G&&(y=w.negate(y,y)),V=w.unpack(i,d,eC),Z=w.unpack(r,d,eH),G=e_(W=w.unpack(a,d,ez),h,V,Z),eS.latitude=o[F],eS.longitude=o[F+1],ex.latitude=o[F+2],ex.longitude=o[F+3],l){let n=function(e,t){let n=Math.abs(e.longitude),i=Math.abs(t.longitude);if(E.equalsEpsilon(n,E.PI,E.EPSILON11)){let i=E.sign(t.longitude);return e.longitude=i*(n-E.EPSILON11),1}if(E.equalsEpsilon(i,E.PI,E.EPSILON11)){let n=E.sign(e.longitude);return t.longitude=n*(i-E.EPSILON11),2}return 0}(eS,ex);e=t.project(eS,eq);let i=et(s=t.project(ex,eG),e,e2);i.y=Math.abs(i.y),u=eV,p=eZ,0===n||w.dot(i,w.UNIT_Y)>B?(u=eP(t,eS,y,e,eV),p=eP(t,ex,W,s,eZ)):1===n?(p=eP(t,ex,W,s,eZ),u.x=0,u.y=E.sign(eS.longitude-Math.abs(ex.longitude)),u.z=0):(u=eP(t,eS,y,e,eV),p.x=0,p.y=E.sign(eS.longitude-ex.longitude),p.z=0)}let T=w.distance(m,Z),O=n.fromCartesian(h,e1),_=w.subtract(V,h,eW),k=w.normalize(_,e$),H=w.subtract(m,h,eJ);H=w.normalize(H,H);let C=w.cross(k,H,e$);C=w.normalize(C,C);let z=w.cross(H,y,eQ);z=w.normalize(z,z);let R=w.subtract(Z,V,eK);R=w.normalize(R,R);let Q=w.cross(W,R,e0);Q=w.normalize(Q,Q);let ee=T/Y,en=J/Y,ei=0,er,ea,eo,el=0,es=0;if(l){ei=w.distance(e,s),er=n.fromCartesian(e,e3),ea=w.subtract(s,e,e2);let t=(eo=w.normalize(ea,e5)).x;eo.x=eo.y,eo.y=-t,el=ei/M,es=K/M}for(c=0;c<8;c++){let e=q+4*c,t=U+2*c,n=e+3,i=c<4?1:-1,r=2===c||3===c||6===c||7===c?1:-1;w.pack(O.high,P,e),P[n]=_.x,w.pack(O.low,A,e),A[n]=_.y,w.pack(z,b,e),b[n]=_.z,w.pack(Q,I,e),I[n]=ee*i,w.pack(C,v,e);let a=en*r;0===a&&r<0&&(a=9),v[n]=a,l&&(N[e]=er.high.x,N[e+1]=er.high.y,N[e+2]=er.low.x,N[e+3]=er.low.y,x[e]=-u.y,x[e+1]=u.x,x[e+2]=p.y,x[e+3]=-p.x,S[e]=ea.x,S[e+1]=ea.y,S[e+2]=eo.x,S[e+3]=eo.y,j[t]=el*i,0==(a=es*r)&&r<0&&(a=9),j[t+1]=a)}let eu=g.fromCartographicArray(eR,eY),ec=D.getMinimumMaximumHeights(eu,f),ep=ec.minimumTerrainHeight,eh=ec.maximumTerrainHeight;$+=Math.abs(ep),$+=Math.abs(eh),eI(h,m,ep,eh,eU,eB),eI(V,Z,ep,eh,eX,eF);let ed=w.multiplyByScalar(C,E.EPSILON5,e7);w.add(eU,ed,eU),w.add(eX,ed,eX),w.add(eB,ed,eB),w.add(eF,ed,eF),eN(eU,eX),eN(eB,eF),w.pack(eU,L,X),w.pack(eX,L,X+3),w.pack(eF,L,X+6),w.pack(eB,L,X+9),ed=w.multiplyByScalar(C,-2*E.EPSILON5,e7),w.add(eU,ed,eU),w.add(eX,ed,eX),w.add(eB,ed,eB),w.add(eF,ed,eF),eN(eU,eX),eN(eB,eF),w.pack(eU,L,X+12),w.pack(eX,L,X+15),w.pack(eF,L,X+18),w.pack(eB,L,X+21),F+=2,d+=3,U+=16,X+=24,q+=32,J+=T,K+=ei}d=0;let Q=0;for(h=0;h<y;h++){for(c=0;c<e9;c++)k[d+c]=e6[c]+Q;Q+=8,d+=e9}p.fromVertices(i,w.ZERO,3,e4[0]),p.fromVertices(r,w.ZERO,3,e4[1]);let ee=p.fromBoundingSpheres(e4);ee.radius+=$/(2*y);let en={position:new u({componentDatatype:m.DOUBLE,componentsPerAttribute:3,normalize:!1,values:L}),startHiAndForwardOffsetX:e8(P),startLoAndForwardOffsetY:e8(A),startNormalAndForwardOffsetZ:e8(b),endNormalAndTextureCoordinateNormalizationX:e8(I),rightNormalAndTextureCoordinateNormalizationY:e8(v)};return l&&(en.startHiLo2D=e8(N),en.offsetAndRight2D=e8(S),en.startEndNormals2D=e8(x),en.texcoordNormalization2D=new u({componentDatatype:m.FLOAT,componentsPerAttribute:2,normalize:!1,values:j})),new s({attributes:en,indices:k,boundingSphere:ee})}(l,f,Y,F,z,C,i)};var ey=new w,eT=new _,eO=new f;function e_(e,t,n,i){let r=et(n,t,ey),a=w.dot(r,e);if(a>B||a<F){let t=et(i,n,eo),r=a<F?E.PI_OVER_TWO:-E.PI_OVER_TWO,o=f.fromAxisAngle(t,r,eO),l=_.fromQuaternion(o,eT);return _.multiplyByVector(l,e,e),!0}return!1}var ek=new y,eE=new w,eL=new w;function eP(e,t,n,i,r){let a=y.toCartesian(t,e._ellipsoid,eE),o=w.add(a,n,eL),l=!1,s=e._ellipsoid,u=s.cartesianToCartographic(o,ek);Math.abs(t.longitude-u.longitude)>E.PI_OVER_TWO&&(l=!0,o=w.subtract(a,n,eL),u=s.cartesianToCartographic(o,ek)),u.height=0;let c=e.project(u,r);return(r=w.subtract(c,i,r)).z=0,r=w.normalize(r,r),l&&w.negate(r,r),r}var eA=new w,eb=new w;function eI(e,t,n,i,r,a){let o=w.subtract(t,e,eA);w.normalize(o,o);let l=w.multiplyByScalar(o,n-0,eb);w.add(e,l,r),l=w.multiplyByScalar(o,i-1e3,eb),w.add(t,l,a)}var ev=new w;function eN(e,t){let n=l.getPointDistance(es,e),i=l.getPointDistance(es,t),r=ev;E.equalsEpsilon(n,0,E.EPSILON2)?(r=et(t,e,r),w.multiplyByScalar(r,E.EPSILON2,r),w.add(e,r,e)):E.equalsEpsilon(i,0,E.EPSILON2)&&(r=et(e,t,r),w.multiplyByScalar(r,E.EPSILON2,r),w.add(t,r,t))}var eS=new y,ex=new y,ej=new w,eH=new w,eM=new w,eC=new w,eD=new w,ez=new w,eR=[eS,ex],eY=new g,eB=new w,eF=new w,eU=new w,eX=new w,eq=new w,eG=new w,eV=new w,eZ=new w,eW=new w,eJ=new w,eK=new w,e$=new w,eQ=new w,e0=new w,e1=new n,e3=new n,e2=new w,e5=new w,e7=new w,e4=[new p,new p],e6=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],e9=e6.length;function e8(e){return new u({componentDatatype:m.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}U._projectNormal=eP;var te=function(e,t){return D.initialize().then(function(){return A(t)&&(e=U.unpack(e,t)),U.createGeometry(e)})};export{te as default};