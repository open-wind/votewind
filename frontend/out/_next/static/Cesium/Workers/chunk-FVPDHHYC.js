import{a as e}from"./chunk-OFGHX2F3.js";import{d as t}from"./chunk-KLPRJ6SC.js";import{b as i,h as o}from"./chunk-4PT23TTH.js";import{a as r}from"./chunk-J4RA3VLE.js";import{a as a,b as s,c as n,d as c}from"./chunk-I4JBCTLR.js";import{a as l}from"./chunk-MCEXFPZL.js";import{a as m,b as u}from"./chunk-BOXFFUY5.js";import{e as d}from"./chunk-OVZZEY7C.js";function h(e,t){u.typeOf.object("ellipsoid",e),this._ellipsoid=e,this._cameraPosition=new a,this._cameraPositionInScaledSpace=new a,this._distanceToLimbInScaledSpaceSquared=0,d(t)&&(this.cameraPosition=t)}Object.defineProperties(h.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){let t=this._ellipsoid.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),i=a.magnitudeSquared(t)-1;a.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=t,this._distanceToLimbInScaledSpaceSquared=i}}});var f=new a;h.prototype.isPointVisible=function(e){return b(this._ellipsoid.transformPositionToScaledSpace(e,f),this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)},h.prototype.isScaledSpacePointVisible=function(e){return b(e,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};var p=new a;h.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(e,t){let i=this._ellipsoid,o,r;return d(t)&&t<0&&i.minimumRadius>-t?((r=p).x=this._cameraPosition.x/(i.radii.x+t),r.y=this._cameraPosition.y/(i.radii.y+t),r.z=this._cameraPosition.z/(i.radii.z+t),o=r.x*r.x+r.y*r.y+r.z*r.z-1):(r=this._cameraPositionInScaledSpace,o=this._distanceToLimbInScaledSpaceSquared),b(e,r,o)},h.prototype.computeHorizonCullingPoint=function(e,t,i){return N(this._ellipsoid,e,t,i)};var S=c.clone(c.UNIT_SPHERE);h.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(e,t,i,o){return N(y(this._ellipsoid,i,S),e,t,o)},h.prototype.computeHorizonCullingPointFromVertices=function(e,t,i,o,r){return P(this._ellipsoid,e,t,i,o,r)},h.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(e,t,i,o,r,a){return P(y(this._ellipsoid,r,S),e,t,i,o,a)};var g=[];h.prototype.computeHorizonCullingPointFromRectangle=function(e,i,r){u.typeOf.object("rectangle",e);let s=o.subsample(e,i,0,g),n=t.fromPoints(s);if(!(a.magnitude(n.center)<.1*i.minimumRadius))return this.computeHorizonCullingPoint(n.center,s,r)};var x=new a;function y(e,t,i){if(d(t)&&t<0&&e.minimumRadius>-t){let o=a.fromElements(e.radii.x+t,e.radii.y+t,e.radii.z+t,x);e=c.fromCartesian3(o,i)}return e}function N(e,t,i,o){u.typeOf.object("directionToPoint",t),u.defined("positions",i),d(o)||(o=new a);let r=C(e,t),s=0;for(let t=0,o=i.length;t<o;++t){let o=E(e,i[t],r);if(o<0)return;s=Math.max(s,o)}return H(r,s,o)}var T=new a;function P(e,t,i,o,r,s){u.typeOf.object("directionToPoint",t),u.defined("vertices",i),u.typeOf.number("stride",o),d(s)||(s=new a),o=o??3,r=r??a.ZERO;let n=C(e,t),c=0;for(let t=0,a=i.length;t<a;t+=o){T.x=i[t]+r.x,T.y=i[t+1]+r.y,T.z=i[t+2]+r.z;let o=E(e,T,n);if(o<0)return;c=Math.max(c,o)}return H(n,c,s)}function b(e,t,i){let o=a.subtract(e,t,f),r=-a.dot(o,t);return!(i<0?r>0:r>i&&r*r/a.magnitudeSquared(o)>i)}var z=new a,_=new a;function E(e,t,i){let o=e.transformPositionToScaledSpace(t,z),r=a.magnitudeSquared(o),s=Math.sqrt(r),n=a.divideByScalar(o,s,_);r=Math.max(1,r),s=Math.max(1,s);let c=a.dot(n,i),l=a.magnitude(a.cross(n,i,n)),m=1/s,u=Math.sqrt(r-1)*m;return 1/(c*m-l*u)}function H(e,t,i){if(!(t<=0||t===1/0||t!=t))return a.multiplyByScalar(e,t,i)}var w=new a;function C(e,t){return a.equals(t,a.ZERO)?t:(e.transformPositionToScaledSpace(t,w),a.normalize(w,w))}var O=h,v={};v.getHeight=function(e,t,i){if(!Number.isFinite(t))throw new m("scale must be a finite number.");if(!Number.isFinite(i))throw new m("relativeHeight must be a finite number.");return(e-i)*t+i};var I=new s;v.getPosition=function(e,t,i,o,r){let s=t.cartesianToCartographic(e,I);if(!d(s))return a.clone(e,r);let n=v.getHeight(s.height,i,o);return a.fromRadians(s.longitude,s.latitude,n,t,r)};var q=Object.freeze({NONE:0,BITS12:1}),G=new a,M=new a,B=new n,V=new i,R=new i;function j(e,t,o,r,s,n,c,l,m,u){let h=q.NONE,f,p;if(d(t)&&d(o)&&d(r)&&d(s)){let e=t.minimum,n=t.maximum,c=a.subtract(n,e,M),l=r-o;h=4095>Math.max(a.maximumComponent(c),l)?q.BITS12:q.NONE,f=i.inverseTransformation(s,new i);let m=a.negate(e,G);i.multiply(i.fromTranslation(m,V),f,f),G.x=1/c.x,G.y=1/c.y,G.z=1/c.z,i.multiply(i.fromScale(G,V),f,f),p=i.clone(s),i.setTranslation(p,a.ZERO,p),s=i.clone(s,new i);let u=i.fromTranslation(e,V),d=i.fromScale(c,R),S=i.multiply(u,d,V);i.multiply(s,S,s),i.multiply(p,S,p)}this.quantization=h,this.minimumHeight=o,this.maximumHeight=r,this.center=a.clone(e),this.toScaledENU=f,this.fromScaledENU=s,this.matrix=p,this.hasVertexNormals=n,this.hasWebMercatorT=c??!1,this.hasGeodeticSurfaceNormals=l??!1,this.exaggeration=m??1,this.exaggerationRelativeHeight=u??0,this.stride=0,this._offsetGeodeticSurfaceNormal=0,this._offsetVertexNormal=0,this._calculateStrideAndOffsets()}j.prototype.encode=function(t,o,r,s,c,m,u,d){let h=s.x,f=s.y;if(this.quantization===q.BITS12){(r=i.multiplyByPoint(this.toScaledENU,r,G)).x=l.clamp(r.x,0,1),r.y=l.clamp(r.y,0,1),r.z=l.clamp(r.z,0,1);let a=this.maximumHeight-this.minimumHeight,s=l.clamp((c-this.minimumHeight)/a,0,1);n.fromElements(r.x,r.y,B);let m=e.compressTextureCoordinates(B);n.fromElements(r.z,s,B);let d=e.compressTextureCoordinates(B);n.fromElements(h,f,B);let p=e.compressTextureCoordinates(B);if(t[o++]=m,t[o++]=d,t[o++]=p,this.hasWebMercatorT){n.fromElements(u,0,B);let i=e.compressTextureCoordinates(B);t[o++]=i}}else a.subtract(r,this.center,G),t[o++]=G.x,t[o++]=G.y,t[o++]=G.z,t[o++]=c,t[o++]=h,t[o++]=f,this.hasWebMercatorT&&(t[o++]=u);return this.hasVertexNormals&&(t[o++]=e.octPackFloat(m)),this.hasGeodeticSurfaceNormals&&(t[o++]=d.x,t[o++]=d.y,t[o++]=d.z),o};var A=new a,U=new a;j.prototype.addGeodeticSurfaceNormals=function(e,t,i){if(this.hasGeodeticSurfaceNormals)return;let o=this.stride,r=e.length/o;this.hasGeodeticSurfaceNormals=!0,this._calculateStrideAndOffsets();let a=this.stride;for(let s=0;s<r;s++){for(let i=0;i<o;i++){let r=s*o+i;t[s*a+i]=e[r]}let r=this.decodePosition(t,s,A),n=i.geodeticSurfaceNormal(r,U),c=s*a+this._offsetGeodeticSurfaceNormal;t[c]=n.x,t[c+1]=n.y,t[c+2]=n.z}},j.prototype.removeGeodeticSurfaceNormals=function(e,t){if(!this.hasGeodeticSurfaceNormals)return;let i=this.stride,o=e.length/i;this.hasGeodeticSurfaceNormals=!1,this._calculateStrideAndOffsets();let r=this.stride;for(let a=0;a<o;a++)for(let o=0;o<r;o++){let s=a*i+o;t[a*r+o]=e[s]}},j.prototype.decodePosition=function(t,o,r){if(d(r)||(r=new a),o*=this.stride,this.quantization===q.BITS12){let a=e.decompressTextureCoordinates(t[o],B);r.x=a.x,r.y=a.y;let s=e.decompressTextureCoordinates(t[o+1],B);return r.z=s.x,i.multiplyByPoint(this.fromScaledENU,r,r)}return r.x=t[o],r.y=t[o+1],r.z=t[o+2],a.add(r,this.center,r)},j.prototype.getExaggeratedPosition=function(e,t,i){i=this.decodePosition(e,t,i);let o=this.exaggeration,r=this.exaggerationRelativeHeight;if(1!==o&&this.hasGeodeticSurfaceNormals){let a=this.decodeGeodeticSurfaceNormal(e,t,U),s=this.decodeHeight(e,t),n=v.getHeight(s,o,r)-s;i.x+=a.x*n,i.y+=a.y*n,i.z+=a.z*n}return i},j.prototype.decodeTextureCoordinates=function(t,i,o){return d(o)||(o=new n),i*=this.stride,this.quantization===q.BITS12?e.decompressTextureCoordinates(t[i+2],o):n.fromElements(t[i+4],t[i+5],o)},j.prototype.decodeHeight=function(t,i){return i*=this.stride,this.quantization===q.BITS12?e.decompressTextureCoordinates(t[i+1],B).y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight:t[i+3]},j.prototype.decodeWebMercatorT=function(t,i){return i*=this.stride,this.quantization===q.BITS12?e.decompressTextureCoordinates(t[i+3],B).x:t[i+6]},j.prototype.getOctEncodedNormal=function(e,t,i){let o=e[t=t*this.stride+this._offsetVertexNormal]/256,r=Math.floor(o);return n.fromElements(r,(o-r)*256,i)},j.prototype.decodeGeodeticSurfaceNormal=function(e,t,i){return t=t*this.stride+this._offsetGeodeticSurfaceNormal,i.x=e[t],i.y=e[t+1],i.z=e[t+2],i},j.prototype._calculateStrideAndOffsets=function(){let e=0;this.quantization===q.BITS12?e+=3:e+=6,this.hasWebMercatorT&&(e+=1),this.hasVertexNormals&&(this._offsetVertexNormal=e,e+=1),this.hasGeodeticSurfaceNormals&&(this._offsetGeodeticSurfaceNormal=e,e+=3),this.stride=e};var F={position3DAndHeight:0,textureCoordAndEncodedNormals:1,geodeticSurfaceNormal:2},L={compressed0:0,compressed1:1,geodeticSurfaceNormal:2};j.prototype.getAttributes=function(e){let t=r.FLOAT,i=r.getSizeInBytes(t),o=this.stride*i,a=0,s=[];function n(r,n){s.push({index:r,vertexBuffer:e,componentDatatype:t,componentsPerAttribute:n,offsetInBytes:a,strideInBytes:o}),a+=n*i}if(this.quantization===q.NONE){let e;n(F.position3DAndHeight,4),e=2+((this.hasWebMercatorT?1:0)+(this.hasVertexNormals?1:0)),n(F.textureCoordAndEncodedNormals,e),this.hasGeodeticSurfaceNormals&&n(F.geodeticSurfaceNormal,3)}else{let e=this.hasWebMercatorT||this.hasVertexNormals,t=this.hasWebMercatorT&&this.hasVertexNormals;n(L.compressed0,e?4:3),t&&n(L.compressed1,1),this.hasGeodeticSurfaceNormals&&n(L.geodeticSurfaceNormal,3)}return s},j.prototype.getAttributeLocations=function(){return this.quantization===q.NONE?F:L},j.clone=function(e,t){if(d(e))return d(t)||(t=new j),t.quantization=e.quantization,t.minimumHeight=e.minimumHeight,t.maximumHeight=e.maximumHeight,t.center=a.clone(e.center),t.toScaledENU=i.clone(e.toScaledENU),t.fromScaledENU=i.clone(e.fromScaledENU),t.matrix=i.clone(e.matrix),t.hasVertexNormals=e.hasVertexNormals,t.hasWebMercatorT=e.hasWebMercatorT,t.hasGeodeticSurfaceNormals=e.hasGeodeticSurfaceNormals,t.exaggeration=e.exaggeration,t.exaggerationRelativeHeight=e.exaggerationRelativeHeight,t._calculateStrideAndOffsets(),t};var W=j;export{O as a,W as b};