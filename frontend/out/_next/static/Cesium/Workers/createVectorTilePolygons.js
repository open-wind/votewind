import{a as e}from"./chunk-HJ6M6NKU.js";import{a as t}from"./chunk-3WQQGQIW.js";import{a as n}from"./chunk-UYGXVO4A.js";import{a as r}from"./chunk-OFGHX2F3.js";import"./chunk-VRX6MZUH.js";import"./chunk-EMIRY7IE.js";import"./chunk-LHHREGTA.js";import"./chunk-O2LOQWK4.js";import{a as a}from"./chunk-I4PVU2XE.js";import"./chunk-KLPRJ6SC.js";import{h as o}from"./chunk-4PT23TTH.js";import"./chunk-J4RA3VLE.js";import{a as i,b as s,d as f}from"./chunk-I4JBCTLR.js";import{a as h}from"./chunk-MCEXFPZL.js";import"./chunk-5IUKPU5Q.js";import"./chunk-B3NSNNUV.js";import"./chunk-BOXFFUY5.js";import{e as l}from"./chunk-OVZZEY7C.js";var c=new i,u=new f,m=new o,p={min:void 0,max:void 0,indexBytesPerElement:void 0},d=new i,g=new i,I=new i,k=new i,b=new i,y=new s,w=new o,A=t(function(t,A){let N,x,E;x=new Float64Array(t.packedBuffer),E=0,p.indexBytesPerElement=x[E++],p.min=x[E++],p.max=x[E++],i.unpack(x,E,c),E+=i.packedLength,f.unpack(x,E,u),E+=f.packedLength,o.unpack(x,E,m),N=2===p.indexBytesPerElement?new Uint16Array(t.indices):new Uint32Array(t.indices);let L=new Uint16Array(t.positions),T=new Uint32Array(t.counts),U=new Uint32Array(t.indexCounts),j=new Uint32Array(t.batchIds),O=new Uint32Array(t.batchTableColors),F=Array(T.length),P=m,S=p.min,B=p.max,R=t.minimumHeights,V=t.maximumHeights;l(R)&&l(V)&&(R=new Float32Array(R),V=new Float32Array(V));let C,G,H,M=L.length/2,Y=L.subarray(0,M),_=L.subarray(M,2*M);r.zigZagDeltaDecode(Y,_);let X=new Float64Array(3*M);for(C=0;C<M;++C){let e=Y[C],t=_[C],n=h.lerp(P.west,P.east,e/32767),r=h.lerp(P.south,P.north,t/32767),a=s.fromRadians(n,r,0,y),o=u.cartographicToCartesian(a,d);i.pack(o,X,3*C)}let J=T.length,Q=Array(J),Z=Array(J),v=0,D=0;for(C=0;C<J;++C)Q[C]=v,Z[C]=D,v+=T[C],D+=U[C];let K=new Float32Array(6*M),W=new Uint16Array(2*M),z=new Uint32Array(Z.length),q=new Uint32Array(U.length),$=[],ee={};for(C=0;C<J;++C)l(ee[H=O[C]])?(ee[H].positionLength+=T[C],ee[H].indexLength+=U[C],ee[H].batchIds.push(C)):ee[H]={positionLength:T[C],indexLength:U[C],offset:0,indexOffset:0,batchIds:[C]};let et,en=0,er=0;for(H in ee)if(ee.hasOwnProperty(H)){(et=ee[H]).offset=en,et.indexOffset=er;let e=2*et.positionLength,t=2*et.indexLength+6*et.positionLength;en+=e,er+=t,et.indexLength=t}let ea=[];for(H in ee)ee.hasOwnProperty(H)&&(et=ee[H],ea.push({color:e.fromRgba(parseInt(H)),offset:et.indexOffset,count:et.indexLength,batchIds:et.batchIds}));for(C=0;C<J;++C){let e=(et=ee[H=O[C]]).offset,t=3*e,r=e,a=Q[C],o=T[C],s=j[C],f=S,h=B;l(R)&&l(V)&&(f=R[C],h=V[C]);let m=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,A=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY;for(G=0;G<o;++G){let e=i.unpack(X,3*a+3*G,d);u.scaleToGeodeticSurface(e,e);let n=u.cartesianToCartographic(e,y),o=n.latitude,l=n.longitude;m=Math.min(o,m),p=Math.max(o,p),A=Math.min(l,A),x=Math.max(l,x);let w=u.geodeticSurfaceNormal(e,g),N=i.multiplyByScalar(w,f,I),E=i.add(e,N,k);N=i.multiplyByScalar(w,h,N);let L=i.add(e,N,b);i.subtract(L,c,L),i.subtract(E,c,E),i.pack(L,K,t),i.pack(E,K,t+3),W[r]=s,W[r+1]=s,t+=6,r+=2}(P=w).west=A,P.east=x,P.south=m,P.north=p,F[C]=n.fromRectangle(P,S,B,u);let E=et.indexOffset,L=Z[C],M=U[C];for(z[C]=E,G=0;G<M;G+=3){let t=N[L+G]-a,n=N[L+G+1]-a,r=N[L+G+2]-a;$[E++]=2*t+e,$[E++]=2*n+e,$[E++]=2*r+e,$[E++]=2*r+1+e,$[E++]=2*n+1+e,$[E++]=2*t+1+e}for(G=0;G<o;++G){let t=G,n=(G+1)%o;$[E++]=2*t+1+e,$[E++]=2*n+e,$[E++]=2*t+e,$[E++]=2*t+1+e,$[E++]=2*n+1+e,$[E++]=2*n+e}et.offset+=2*o,et.indexOffset=E,q[C]=E-z[C]}$=a.createTypedArray(K.length/3,$);let eo=ea.length;for(let e=0;e<eo;++e){let t=ea[e].batchIds,n=0,r=t.length;for(let e=0;e<r;++e)n+=q[t[e]];ea[e].count=n}let ei=function(t,r,a){let o=r.length,i=new Float64Array(2+o*n.packedLength+1+function(t){let n=t.length,r=0;for(let a=0;a<n;++a)r+=e.packedLength+3+t[a].batchIds.length;return r}(a)),s=0;i[s++]=t,i[s++]=o;for(let e=0;e<o;++e)n.pack(r[e],i,s),s+=n.packedLength;let f=a.length;i[s++]=f;for(let t=0;t<f;++t){let n=a[t];e.pack(n.color,i,s),s+=e.packedLength,i[s++]=n.offset,i[s++]=n.count;let r=n.batchIds,o=r.length;i[s++]=o;for(let e=0;e<o;++e)i[s++]=r[e]}return i}(2===$.BYTES_PER_ELEMENT?a.UNSIGNED_SHORT:a.UNSIGNED_INT,F,ea);return A.push(K.buffer,$.buffer,z.buffer,q.buffer,W.buffer,ei.buffer),{positions:K.buffer,indices:$.buffer,indexOffsets:z.buffer,indexCounts:q.buffer,batchIds:W.buffer,packedBuffer:ei.buffer}});export{A as default};