import{a as e}from"./chunk-4KTYBIT7.js";import{a as t}from"./chunk-7Q53UG4E.js";import{a as n,b as i}from"./chunk-AKNTYFRF.js";import{a as o}from"./chunk-VKBMYYL4.js";import{a as r}from"./chunk-MQ2J7IEP.js";import{b as s}from"./chunk-LHHREGTA.js";import{a as a}from"./chunk-O2LOQWK4.js";import{a as l}from"./chunk-I4PVU2XE.js";import{a as u}from"./chunk-TMRGWDA2.js";import{b as c,c as h,d as f}from"./chunk-OST65WKL.js";import{f as p}from"./chunk-4PT23TTH.js";import{a as g}from"./chunk-J4RA3VLE.js";import{a as d,b as m,c as y,d as v,e as T}from"./chunk-I4JBCTLR.js";import{a as b}from"./chunk-MCEXFPZL.js";import{e as x}from"./chunk-OVZZEY7C.js";var I=function(e,t){this.positions=x(e)?e:[],this.holes=x(t)?t:[]};function L(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(L.prototype,{length:{get:function(){return this._length}}}),L.prototype.enqueue=function(e){this._array.push(e),this._length++},L.prototype.dequeue=function(){if(0===this._length)return;let e=this._array,t=this._offset,n=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,n},L.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},L.prototype.contains=function(e){return -1!==this._array.indexOf(e)},L.prototype.clear=function(){this._array.length=this._offset=this._length=0},L.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var w={};w.computeHierarchyPackedLength=function(e,t){let n=0,i=[e];for(;i.length>0;){let e=i.pop();if(!x(e))continue;n+=2;let o=e.positions,r=e.holes;if(x(o)&&o.length>0&&(n+=o.length*t.packedLength),x(r)){let e=r.length;for(let t=0;t<e;++t)i.push(r[t])}}return n},w.packPolygonHierarchy=function(e,t,n,i){let o=[e];for(;o.length>0;){let e=o.pop();if(!x(e))continue;let r=e.positions,s=e.holes;if(t[n++]=x(r)?r.length:0,t[n++]=x(s)?s.length:0,x(r)){let e=r.length;for(let o=0;o<e;++o,n+=i.packedLength)i.pack(r[o],t,n)}if(x(s)){let e=s.length;for(let t=0;t<e;++t)o.push(s[t])}}return n},w.unpackPolygonHierarchy=function(e,t,n){let i=e[t++],o=e[t++],r=Array(i),s=o>0?Array(o):void 0;for(let o=0;o<i;++o,t+=n.packedLength)r[o]=n.unpack(e,t);for(let i=0;i<o;++i)s[i]=w.unpackPolygonHierarchy(e,t,n),t=s[i].startingIndex,delete s[i].startingIndex;return{positions:r,holes:s,startingIndex:t}};var E=new y;function _(e,t,n,i){return y.subtract(t,e,E),y.multiplyByScalar(E,n/i,E),y.add(e,E,E),[E.x,E.y]}var A=new d;w.subdivideLineCount=function(e,t,n){let i=d.distance(e,t)/n;return Math.pow(2,Math.max(0,Math.ceil(b.log2(i))))};var M=new m,C=new m,S=new m,k=new d,O=new r;w.subdivideRhumbLineCount=function(e,t,n,i){let o=new r(e.cartesianToCartographic(t,M),e.cartesianToCartographic(n,C),e).surfaceDistance/i;return Math.pow(2,Math.max(0,Math.ceil(b.log2(o))))},w.subdivideTexcoordLine=function(e,t,n,i,o,r){let s=w.subdivideLineCount(n,i,o),a=y.distance(e,t),l=a/s;r.length=2*s;let u=0;for(let n=0;n<s;n++){let i=_(e,t,n*l,a);r[u++]=i[0],r[u++]=i[1]}return r},w.subdivideLine=function(e,t,n,i){let o=w.subdivideLineCount(e,t,n),r=d.distance(e,t),s=r/o;x(i)||(i=[]);let a=i;a.length=3*o;let l=0;for(let n=0;n<o;n++){var u;let i=(u=n*s,d.subtract(t,e,A),d.multiplyByScalar(A,u/r,A),d.add(e,A,A),[A.x,A.y,A.z]);a[l++]=i[0],a[l++]=i[1],a[l++]=i[2]}return a},w.subdivideTexcoordRhumbLine=function(e,t,n,i,o,r,s){let a=n.cartesianToCartographic(i,M),l=n.cartesianToCartographic(o,C);O.setEndPoints(a,l);let u=O.surfaceDistance/r,c=Math.pow(2,Math.max(0,Math.ceil(b.log2(u)))),h=y.distance(e,t),f=h/c;s.length=2*c;let p=0;for(let n=0;n<c;n++){let i=_(e,t,n*f,h);s[p++]=i[0],s[p++]=i[1]}return s},w.subdivideRhumbLine=function(e,t,n,i,o){let s=new r(e.cartesianToCartographic(t,M),e.cartesianToCartographic(n,C),e);if(x(o)||(o=[]),s.surfaceDistance<=i)return o.length=3,o[0]=t.x,o[1]=t.y,o[2]=t.z,o;let a=s.surfaceDistance/i,l=Math.pow(2,Math.max(0,Math.ceil(b.log2(a)))),u=s.surfaceDistance/l,c=o;c.length=3*l;let h=0;for(let t=0;t<l;t++){let n=s.interpolateUsingSurfaceDistance(t*u,S),i=e.cartographicToCartesian(n,k);c[h++]=i.x,c[h++]=i.y,c[h++]=i.z}return c};var P=new d,N=new d,R=new d,D=new d;w.scaleToGeodeticHeightExtruded=function(e,t,n,i,o){i=i??v.default;let r=N,s=D;if(x(e)&&x(e.attributes)&&x(e.attributes.position)){let a=e.attributes.position.values,l=a.length/2;for(let e=0;e<l;e+=3)d.fromArray(a,e,R),i.geodeticSurfaceNormal(R,P),s=i.scaleToGeodeticSurface(R,s),r=d.multiplyByScalar(P,n,r),r=d.add(s,r,r),a[e+l]=r.x,a[e+1+l]=r.y,a[e+2+l]=r.z,o&&(s=d.clone(R,s)),r=d.multiplyByScalar(P,t,r),r=d.add(s,r,r),a[e]=r.x,a[e+1]=r.y,a[e+2]=r.z}return e},w.polygonOutlinesFromHierarchy=function(e,t,n){let i,r,s,a=[],l=new L;for(l.enqueue(e);0!==l.length;){let e=l.dequeue(),u=e.positions;if(t)for(s=u.length,i=0;i<s;i++)n.scaleToGeodeticSurface(u[i],u[i]);if((u=o(u,d.equalsEpsilon,!0)).length<3)continue;let c=e.holes?e.holes.length:0;for(i=0;i<c;i++){let u=e.holes[i],c=u.positions;if(t)for(s=c.length,r=0;r<s;++r)n.scaleToGeodeticSurface(c[r],c[r]);if((c=o(c,d.equalsEpsilon,!0)).length<3)continue;a.push(c);let h=0;for(x(u.holes)&&(h=u.holes.length),r=0;r<h;r++)l.enqueue(u.holes[r])}a.push(u)}return a};var G=new m,j=new m;w.splitPolygonsOnEquator=function(t,n,i,o){x(o)||(o=[]),o.splice(0,0,...t),o.length=t.length;let r=0;for(;r<o.length;){let t=o[r],l=t.slice();if(t.length<3){o[r]=l,++r;continue}let u=function(t,n,i){let o=[],r,l,u,c,h,f=0;for(;f<t.length;){r=t[f],l=t[(f+1)%t.length],u=b.sign(r.z),c=b.sign(l.z);let p=e=>n.cartesianToCartographic(e,j).longitude;if(0===u)o.push({position:f,type:u,visited:!1,next:c,theta:p(r)});else if(0!==c){if(h=function(t,n,i,o){if(o===e.RHUMB)return function(e,t,n){let i=n.cartesianToCartographic(e,M),o=n.cartesianToCartographic(t,C);if(Math.sign(i.latitude)===Math.sign(o.latitude))return;O.setEndPoints(i,o);let r=O.findIntersectionWithLatitude(0,G);if(!x(r))return;let s=Math.min(i.longitude,o.longitude),a=Math.max(i.longitude,o.longitude);if(Math.abs(a-s)>b.PI){let e=s;s=a,a=e}if(!(r.longitude<s||r.longitude>a))return n.cartographicToCartesian(r)}(t,n,i);let r=s.lineSegmentPlane(t,n,a.ORIGIN_XY_PLANE);if(x(r))return i.scaleToGeodeticSurface(r,r)}(r,l,n,i),++f,!x(h))continue;t.splice(f,0,h),o.push({position:f,type:u,visited:!1,next:c,theta:p(h)})}++f}return o}(l,n,i);if(l.length===t.length||u.length<=1){o[r]=l,++r;continue}u.sort((e,t)=>e.theta-t.theta);let c=l[0].z>=0;r=function e(t,n,i,o,r,s,a){let l=[],u=s,c=e=>t=>t.position===e,h=[];do{let e=i[u];l.push(e);let t=o.findIndex(c(u)),n=o[t];if(!x(n)){++u;continue}let{visited:r,type:f,next:p}=n;if(n.visited=!0,0===f){if(0===p){let e=o[t-(a?1:-1)];if(e?.position===u+1)e.visited=!0;else{++u;continue}}if(!r&&a&&p>0||s===u&&!a&&p<0){++u;continue}}if(!(a?f>=0:f<=0)){++u;continue}r||h.push(u);let g=o[t+(a?1:-1)];if(!x(g)){++u;continue}u=g.position}while(u<i.length&&u>=0&&u!==s&&l.length<i.length);for(let s of(t.splice(n,r,l),h))n=e(t,++n,i,o,0,s,!a);return n}(o,r,l,u,1,0,c)}return o},w.polygonsFromHierarchy=function(e,t,r,s,a,l){let u=[],c=[],h=new L;h.enqueue(e);let f=x(l);for(;0!==h.length;){let e=h.dequeue(),p=e.positions,g=e.holes,m,y;if(s)for(y=p.length,m=0;m<y;m++)a.scaleToGeodeticSurface(p[m],p[m]);if(t||(p=o(p,d.equalsEpsilon,!0)),p.length<3)continue;let v=r(p);if(!x(v))continue;let T=[],b=i.computeWindingOrder2D(v);if(b===n.CLOCKWISE&&(v.reverse(),p=p.slice().reverse()),f){f=!1;let e=[p];if((e=l(e,e)).length>1){for(let t of e)h.enqueue(new I(t,g));continue}}let L=p.slice(),w=x(g)?g.length:0,E=[],_;for(m=0;m<w;m++){let e=g[m],l=e.positions;if(s)for(y=l.length,_=0;_<y;++_)a.scaleToGeodeticSurface(l[_],l[_]);if(t||(l=o(l,d.equalsEpsilon,!0)),l.length<3)continue;let u=r(l);if(!x(u))continue;(b=i.computeWindingOrder2D(u))===n.CLOCKWISE&&(u.reverse(),l=l.slice().reverse()),E.push(l),T.push(L.length),L=L.concat(l),v=v.concat(u);let c=0;for(x(e.holes)&&(c=e.holes.length),_=0;_<c;_++)h.enqueue(e.holes[_])}u.push({outerRing:p,holes:E}),c.push({positions:L,positions2D:v,holes:T})}return{hierarchy:u,polygons:c}};var q=new y,B=new d,H=new p,z=new T;w.computeBoundingRectangle=function(e,t,n,i,o){let r=p.fromAxisAngle(e,i,H),s=T.fromQuaternion(r,z),a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,h=n.length;for(let e=0;e<h;++e){let i=d.clone(n[e],B);T.multiplyByVector(s,i,i);let o=t(i,q);x(o)&&(a=Math.min(a,o.x),l=Math.max(l,o.x),u=Math.min(u,o.y),c=Math.max(c,o.y))}return o.x=a,o.y=u,o.width=l-a,o.height=c-u,o},w.createGeometryFromPositions=function(n,o,r,s,a,l,u){let p=i.triangulate(o.positions2D,o.holes);p.length<3&&(p=[0,1,2]);let d=o.positions,m=x(r),v=m?r.positions:void 0;if(a){let e=d.length,n=Array(3*e),i=0;for(let t=0;t<e;t++){let e=d[t];n[i++]=e.x,n[i++]=e.y,n[i++]=e.z}let o={attributes:{position:new f({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:n})},indices:p,primitiveType:c.TRIANGLES};m&&(o.attributes.st=new f({componentDatatype:g.FLOAT,componentsPerAttribute:2,values:y.packArray(v)}));let r=new h(o);return l.normal?t.computeNormal(r):r}return u===e.GEODESIC?i.computeSubdivision(n,d,p,v,s):u===e.RHUMB?i.computeRhumbLineSubdivision(n,d,p,v,s):void 0};var F=[],Y=[],U=new d,V=new d;w.computeWallGeometry=function(t,n,i,o,r,s){let a,p,m,y,v,T,I,L,E,_=t.length,A=0,M=0,C=x(n),S=C?n.positions:void 0;if(r)for(a=Array(2*(p=6*_)),C&&(L=Array(2*(E=4*_))),m=0;m<_;m++)y=t[m],v=t[(m+1)%_],a[A]=a[A+p]=y.x,a[++A]=a[A+p]=y.y,a[++A]=a[A+p]=y.z,a[++A]=a[A+p]=v.x,a[++A]=a[A+p]=v.y,a[++A]=a[A+p]=v.z,++A,C&&(T=S[m],I=S[(m+1)%_],L[M]=L[M+E]=T.x,L[++M]=L[M+E]=T.y,L[++M]=L[M+E]=I.x,L[++M]=L[M+E]=I.y,++M);else{let n=b.chordLength(o,i.maximumRadius),r=0;if(s===e.GEODESIC)for(m=0;m<_;m++)r+=w.subdivideLineCount(t[m],t[(m+1)%_],n);else if(s===e.RHUMB)for(m=0;m<_;m++)r+=w.subdivideRhumbLineCount(i,t[m],t[(m+1)%_],n);for(a=Array(2*(p=(r+_)*3)),C&&(L=Array(2*(E=(r+_)*2))),m=0;m<_;m++){let o,r;y=t[m],v=t[(m+1)%_],C&&(T=S[m],I=S[(m+1)%_]),s===e.GEODESIC?(o=w.subdivideLine(y,v,n,Y),C&&(r=w.subdivideTexcoordLine(T,I,y,v,n,F))):s===e.RHUMB&&(o=w.subdivideRhumbLine(i,y,v,n,Y),C&&(r=w.subdivideTexcoordRhumbLine(T,I,i,y,v,n,F)));let l=o.length;for(let e=0;e<l;++e,++A)a[A]=o[e],a[A+p]=o[e];if(a[A]=v.x,a[A+p]=v.x,a[++A]=v.y,a[A+p]=v.y,a[++A]=v.z,a[A+p]=v.z,++A,C){let e=r.length;for(let t=0;t<e;++t,++M)L[M]=r[t],L[M+E]=r[t];L[M]=I.x,L[M+E]=I.x,L[++M]=I.y,L[M+E]=I.y,++M}}}_=a.length;let k=l.createTypedArray(_/3,_-6*t.length),O=0;for(_/=6,m=0;m<_;m++){let e=m,t=e+1,n=e+_,i=n+1;y=d.fromArray(a,3*e,U),v=d.fromArray(a,3*t,V),d.equalsEpsilon(y,v,b.EPSILON10,b.EPSILON10)||(k[O++]=e,k[O++]=n,k[O++]=t,k[O++]=t,k[O++]=n,k[O++]=i)}let P={attributes:new u({position:new f({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:a})}),indices:k,primitiveType:c.TRIANGLES};return C&&(P.attributes.st=new f({componentDatatype:g.FLOAT,componentsPerAttribute:2,values:L})),new h(P)};var W=w;export{W as a};