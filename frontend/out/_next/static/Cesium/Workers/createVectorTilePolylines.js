import{a as e}from"./chunk-3WQQGQIW.js";import{a as r}from"./chunk-OFGHX2F3.js";import{a as t}from"./chunk-I4PVU2XE.js";import{c as a,h as n}from"./chunk-4PT23TTH.js";import"./chunk-J4RA3VLE.js";import{a as o,b as s,d as u}from"./chunk-I4JBCTLR.js";import{a as f}from"./chunk-MCEXFPZL.js";import"./chunk-5IUKPU5Q.js";import"./chunk-B3NSNNUV.js";import"./chunk-BOXFFUY5.js";import"./chunk-OVZZEY7C.js";var i=new s,c=new o,p=function(e,t,a,n,u){let p=e.length/3,l=e.subarray(0,p),d=e.subarray(p,2*p),h=e.subarray(2*p,3*p);r.zigZagDeltaDecode(l,d,h);let k=new Float64Array(e.length);for(let e=0;e<p;++e){let r=l[e],p=d[e],b=h[e],m=f.lerp(t.west,t.east,r/32767),w=f.lerp(t.south,t.north,p/32767),y=f.lerp(a,n,b/32767),A=s.fromRadians(m,w,y,i),U=u.cartographicToCartesian(A,c);o.pack(U,k,3*e)}return k},l=new n,d=new u,h=new o,k={min:void 0,max:void 0},b=new o,m=new o,w=new o,y=new o,A=new o,U=e(function(e,r){var s;let f,i=new Uint16Array(e.positions),c=new Uint16Array(e.widths),U=new Uint32Array(e.counts),j=new Uint16Array(e.batchIds);s=new Float64Array(s=e.packedBuffer),f=0,k.min=s[f++],k.max=s[f++],n.unpack(s,f,l),f+=n.packedLength,u.unpack(s,f,d),f+=u.packedLength,o.unpack(s,f,h);let E=p(i,l,k.min,k.max,d),F=E.length/3,P=4*F-4,g=new Float32Array(3*P),I=new Float32Array(3*P),T=new Float32Array(3*P),N=new Float32Array(2*P),x=new Uint16Array(P),D=0,L=0,v=0,B,O=0,R=U.length;for(B=0;B<R;++B){let e=U[B],r=c[B],t=j[B];for(let a=0;a<e;++a){let n;if(0===a){let e=o.unpack(E,3*O,b),r=o.unpack(E,(O+1)*3,m);n=o.subtract(e,r,w),o.add(e,n,n)}else n=o.unpack(E,(O+a-1)*3,w);let s=o.unpack(E,(O+a)*3,y),u;if(a===e-1){let r=o.unpack(E,(O+e-1)*3,b),t=o.unpack(E,(O+e-2)*3,m);u=o.subtract(r,t,A),o.add(r,u,u)}else u=o.unpack(E,(O+a+1)*3,A);o.subtract(n,h,n),o.subtract(s,h,s),o.subtract(u,h,u);let f=0===a?2:0,i=a===e-1?2:4;for(let e=f;e<i;++e){o.pack(s,g,D),o.pack(n,I,D),o.pack(u,T,D),D+=3;let a=e-2<0?-1:1;N[L++]=e%2*2-1,N[L++]=a*r,x[v++]=t}}O+=e}let S=t.createTypedArray(P,6*F-6),C=0,G=0;for(R=F-1,B=0;B<R;++B)S[G++]=C,S[G++]=C+2,S[G++]=C+1,S[G++]=C+1,S[G++]=C+2,S[G++]=C+3,C+=4;r.push(g.buffer,I.buffer,T.buffer),r.push(N.buffer,x.buffer,S.buffer);let Q={indexDatatype:2===S.BYTES_PER_ELEMENT?t.UNSIGNED_SHORT:t.UNSIGNED_INT,currentPositions:g.buffer,previousPositions:I.buffer,nextPositions:T.buffer,expandAndWidth:N.buffer,batchIds:x.buffer,indices:S.buffer};if(e.keepDecodedPositions){let e=function(e){let r=e.length,t=new Uint32Array(r+1),a=0;for(let n=0;n<r;++n)t[n]=a,a+=e[n];return t[r]=a,t}(U);r.push(E.buffer,e.buffer),Q=a(Q,{decodedPositions:E.buffer,decodedPositionOffsets:e.buffer})}return Q});export{U as default};